---
description: Log every encountered issue to REPORT.md
alwaysApply: true
---

# Issue Reporting Rule (Mandatory)

Whenever you encounter an issue while working in this workspace (tool failure, terminal command failure, install error, config mismatch, unexpected behavior, flaky environment, etc.), you MUST add an entry to `REPORT.md` in the repository root.

## Table of Contents
- [What to Log](#what-to-log)
- [How to Log](#how-to-log)
- [Prevention Strategies](#prevention-strategies)
- [Common Issue Patterns](#common-issue-patterns)
- [Guidelines for Contributors](#guidelines-for-contributors)

## What to Log

### Must Log (Critical Priority)
- Any command that exits non-zero unexpectedly
- Any crash/hang/timeout blocking development
- Security or permission issues
- Data loss or corruption
- Breaking changes in functionality

### Should Log (High/Medium Priority)
- Missing tools or PATH problems
- Permission/ExecutionPolicy blocks
- Broken dependency installs
- Linter/typecheck failures introduced by changes
- Performance regressions
- Unexpected behavior requiring investigation

### Don't Log (Low Priority)
- Expected behavior changes
- Personal preference issues
- Cosmetic/visual problems
- Temporary network issues (unless persistent)

## How to Log

Append a new entry under "## Issues" in `REPORT.md` using this template:

```markdown
### YYYY-MM-DD HH:MM (local) — <short descriptive title>
- **Context**: <what you were trying to do>
- **Command / action**: `<exact command or action>`
- **Observed**: <error message / behavior>
- **Root cause**: <what caused this issue>
- **Fix**: <what changed / what to do next>
- **Prevention**: <how to prevent this issue in the future>
- **Status**: resolved | mitigated | unresolved
```

### Important Guidelines
- Do not delete or rewrite history in `REPORT.md`; only append new entries
- If you hit multiple distinct issues in one session, log each separately
- Always include a **Prevention** field to help future users avoid the same issue
- Use timestamps in local time zone format

## Prevention Strategies

Based on resolved issues in `REPORT.md`, follow these guidelines to prevent common problems:

### PowerShell Script Best Practices

#### 1. Parameter Block Placement
- `param()` MUST be the first non-comment statement in PowerShell scripts
- Place it at the very top, before any variable assignments or function definitions
- **Reference**: Issue "run.ps1: param block must be first in script"

#### 2. Shell Syntax Compatibility
- NEVER use bash operators (`&&`, `||`) in PowerShell
- Use PowerShell equivalents:
  - `&&` → `;` or `if ($?) { ... }`
  - `||` → `if (-not $?) { ... }`
- Always use PowerShell 7 syntax, never bash
- **Reference**: Issue "PowerShell does not support `&&` chaining"

#### 3. Command Chaining
- Use semicolon (`;`) to chain commands: `cd path; python --version`
- Or use conditional execution: `if ($?) { next-command }`
- Never assume bash syntax will work

### Tool Execution Best Practices

#### 1. Transient Failures
- If a command fails with "spawn aborted" or similar transient error, retry once
- Don't assume first failure is permanent
- Log the retry attempt in the issue entry
- **Reference**: Issue "tool command spawn aborted"

#### 2. Path and Environment Checks
- Don't rely on Cursor internal paths (e.g., `.cursor/projects/.../terminals`)
- Use script-based checks instead (e.g., `Get-Command`, `Test-Path`)
- Verify tool availability with `Get-Command` before using
- **Reference**: Issue "terminals folder path not found via file lister"

#### 3. Error Handling
- Always check exit codes and handle errors gracefully
- Use `$ErrorActionPreference = "Stop"` in scripts for better error visibility
- Log errors to files for debugging (see `run.ps1` pattern)

## Common Issue Patterns

### PowerShell Script Issues

#### Example 1: PowerShell Syntax Error
**Issue**: `Le jeton '&&' n'est pas un séparateur d'instruction valide.`
**Context**: Attempted to chain commands using bash syntax in PowerShell
**Prevention**: Use `;` instead of `&&` in PowerShell commands
**Correct**: `cd path; git status`
**Wrong**: `cd path && git status`
**What I learned**: PowerShell uses different operators than bash. Always test command syntax in the target shell.

#### Example 2: Parameter Block Placement Error
**Issue**: `The variable '$JsScript' cannot be retrieved because it has not been set.`
**Context**: Script failed during preflight checks due to strict PowerShell parameter validation
**Prevention**: Place `param()` block at the very top of the script, before any other code
**Correct**:
```powershell
param([string]$JsScript = "dev")
$ErrorActionPreference = "Stop"
# rest of script...
```
**What I learned**: PowerShell requires parameter declarations before any executable code. This is different from bash scripts.

### Git and Version Control Issues

#### Example 3: GitHub Email Privacy Block
**Issue**: `remote: error: GH007: Your push would publish a private email address`
**Prevention**: Configure git with GitHub no-reply email before first commit:
```powershell
# Detect GitHub username
$ghUser = (gh api user --jq .login) 2>$null
if ($ghUser) {
 git config --local user.email "$ghUser@users.noreply.github.com"
 git config --local user.name $ghUser
}
```

### Tool Execution Issues

#### Example 4: Tool Spawn Failure
**Issue**: `Error: Command failed to spawn: Aborted`
**Prevention**: Retry transient failures once; if it persists, investigate PATH or execution policy
**Action**: Re-run the command; if it works, log as transient failure

### Python Environment Issues

#### Common Problems
- Virtual environment not activated
- Package installation failures
- Import errors due to missing dependencies
- Python version conflicts

#### Prevention Strategies
- Always activate virtual environment: `.\venv\Scripts\activate`
- Use `requirements.txt` or `pyproject.toml` for dependencies
- Check Python version compatibility before installation
- Validate environment before running scripts

### Network and API Issues

#### Common Problems
- Connection timeouts
- Authentication failures
- Rate limiting
- DNS resolution issues
- SSL certificate problems

#### Prevention Strategies
- Implement retry logic with exponential backoff
- Handle network timeouts gracefully
- Validate API keys and tokens before use
- Use connection pooling for multiple requests
- Log network errors with context

### IDE and Editor Issues

#### Common Problems
- Extension conflicts
- Workspace configuration problems
- File watching failures
- Linting errors
- Auto-completion issues

#### Prevention Strategies
- Keep extensions updated
- Use consistent workspace settings
- Validate configuration files
- Clear editor cache when issues occur
- Check extension compatibility

### Dependency Management Issues

#### Common Problems
- Version conflicts between packages
- Lock file inconsistencies
- Circular dependencies
- Build failures
- Platform-specific package issues

#### Prevention Strategies
- Use dependency locking (requirements.txt, poetry.lock, etc.)
- Specify version ranges carefully
- Test dependency updates in isolation
- Use virtual environments to isolate projects
- Document known compatibility issues

#### Example 5: Python Virtual Environment Not Activated
**Issue**: `ModuleNotFoundError: No module named 'requests'`
**Context**: Script ran successfully in development but failed in CI/production
**Prevention**: Always activate virtual environment before running Python scripts
**Correct**: `.\venv\Scripts\activate; python script.py`
**Wrong**: `python script.py` (without activation)`
**What I learned**: Virtual environments isolate dependencies. Always ensure proper environment activation in all contexts.

#### Example 6: Network Connection Timeout
**Issue**: `requests.exceptions.ConnectTimeout: HTTPSConnectionPool(host='api.example.com', port=443): Max retries exceeded`
**Prevention**: Implement timeout handling and retry logic in network requests
**Code Pattern**:
```python
import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

session = requests.Session()
retry = Retry(total=3, backoff_factor=1)
adapter = HTTPAdapter(max_retries=retry)
session.mount('http://', adapter)
session.mount('https://', adapter)
```

#### Example 7: Dependency Version Conflict
**Issue**: `ImportError: cannot import name 'urlparse' from 'urllib.parse'`
**Prevention**: Pin dependency versions and test compatibility
**In requirements.txt**:
```
requests==2.28.1
urllib3>=1.26.0,<2.0.0
```

## Guidelines for Contributors

### When Logging Issues
- Include prevention steps in the "Root cause" field when possible
- Always add a "Prevention" field to help future users
- Cross-reference related issues in REPORT.md
- Use consistent formatting and terminology

### Maintaining This Rule
- Update this rule file if new issue patterns emerge
- Add new prevention strategies based on resolved issues
- Review and consolidate similar issues quarterly
- Ensure examples remain current and relevant

### Cross-References to REPORT.md Issues

| Issue Pattern | REPORT.md Reference | Prevention Strategy |
|---|----|----|
| PowerShell param() placement | "run.ps1: param block must be first in script" | Parameter Block Placement |
| PowerShell && operator | "PowerShell does not support `&&` chaining" | Shell Syntax Compatibility |
| Tool spawn failure | "tool command spawn aborted" | Transient Failures |
| Path access issues | "terminals folder path not found via file lister" | Path and Environment Checks |

### Automated Helper Functions

Add these PowerShell functions to your profile for easier issue logging:

```powershell
function New-IssueEntry {
 param(
 [string]$Title,
 [string]$Context,
 [string]$Command,
 [string]$Observed,
 [string]$RootCause,
 [string]$Fix,
 [string]$Prevention,
 [ValidateSet("resolved", "mitigated", "unresolved")]
 [string]$Status = "unresolved"
 )

 $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm"
 $entry = @"

### $timestamp (local) — $Title
- **Context**: $Context
- **Command / action**: `$Command`
- **Observed**: $Observed
- **Root cause**: $RootCause
- **Fix**: $Fix
- **Prevention**: $Prevention
- **Status**: $Status
"@

 # Append to REPORT.md
 $reportPath = Join-Path $PSScriptRoot "REPORT.md"
 Add-Content -Path $reportPath -Value $entry

 Write-Host "Issue logged to REPORT.md" -ForegroundColor Green
}

function Get-IssuePattern {
 param([string]$ErrorMessage)

 # Pattern matching for quick categorization
 $patterns = @{
 "Le jeton .* n'est pas un séparateur" = "PowerShell Syntax Error"
 "cannot import name" = "Python Import Error"
 "ModuleNotFoundError" = "Python Module Not Found"
 "Command failed to spawn" = "Tool Spawn Failure"
 "cannot be retrieved because it has not been set" = "PowerShell Parameter Error"
 }

 foreach ($pattern in $patterns.Keys) {
 if ($ErrorMessage -match $pattern) {
 return $patterns[$pattern]
 }
 }

 return "Uncategorized Issue"
}

function Test-EnvironmentHealth {
 # Quick environment validation
 Write-Host "=== Environment Health Check ===" -ForegroundColor Cyan

 # PowerShell version
 Write-Host "PowerShell Version: $($PSVersionTable.PSVersion)" -ForegroundColor Yellow

 # Execution policy
 $policy = Get-ExecutionPolicy
 Write-Host "Execution Policy: $policy" -ForegroundColor Yellow

 # Common tools
 $tools = @('git', 'python', 'node', 'npm')
 foreach ($tool in $tools) {
 try {
 $version = & $tool --version 2>$null
 Write-Host "$tool`: $version" -ForegroundColor Green
 }
 catch {
 Write-Host "$tool`: Not found" -ForegroundColor Red
 }
 }
}

## Quick Reference Summary

### Priority Levels
- **Critical**: Log immediately - blocking issues, security, data loss
- **High**: Investigate and log - unexpected behavior
- **Medium**: Log with workaround - known issues
- **Low**: Usually don't log - preferences, cosmetics

### Essential Fields (always include)
- Context: What you were trying to do
- Command: Exact command that failed
- Observed: Actual error/behavior
- Root cause: Why it happened
- Prevention: How to avoid in future

### Common Prevention Patterns
1. **PowerShell**: Use `;` not `&&`, param() first, strict error handling
2. **Python**: Activate venv, pin versions, check imports
3. **Tools**: Verify PATH, retry transients, check permissions
4. **Network**: Handle timeouts, implement retries, validate connections

### Issue Resolution Workflow
```
Issue encountered?
├── Gather context (what, when, environment)
├── Try immediate fixes (restart, clear cache, check paths)
├── Search REPORT.md for similar issues
├── Check prevention strategies above
├── Still broken?
 ├── YES: Log new issue with full details
 └── NO: Document the fix for future reference
```

### Pre-flight Checks
Before running complex operations, consider these validations:

```powershell
# PowerShell environment check
$PSVersionTable.PSVersion
Get-ExecutionPolicy

# Tool availability check
Get-Command git, python, node, npm -ErrorAction SilentlyContinue

# Path validation
Test-Path "path\to\important\file"
```

### Decision Framework for Issue Logging

#### Quick Assessment Questions
1. **Is development blocked?** → Log immediately (Critical)
2. **Is data at risk?** → Log immediately (Critical)
3. **Is it a security issue?** → Log immediately (Critical)
4. **Is it unexpected behavior?** → Log with investigation (High)
5. **Can it be worked around?** → Log as mitigated (Medium)
6. **Is it intermittent?** → Retry once, then log if persistent (Medium)
7. **Is it a personal preference?** → Don't log (Low)

#### Issue Priority Levels
- **Critical**: Blocks development, data loss, security risks
- **High**: Unexpected behavior requiring investigation
- **Medium**: Known issues with workarounds, performance issues
- **Low**: Cosmetic issues, personal preferences

#### Troubleshooting Workflow
```
Issue encountered?
├── Gather context (what, when, environment)
├── Try immediate fixes (restart, clear cache, check paths)
├── Search REPORT.md for similar issues
├── Check prevention strategies above
├── Still broken?
 ├── YES: Log new issue with full details
 └── NO: Document the fix for future reference
```

#### Before Logging: Required Information
- Exact command or action that failed
- Complete error message/output
- Environment details (OS, versions, paths)
- Steps to reproduce
- Expected vs. actual behavior
- Any recent changes that might be related